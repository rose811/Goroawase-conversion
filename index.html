<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <title>고로아와세 변환기</title>
  <style>
    #suggestions button {
      margin: 0.25rem;
    }
    main > article, main > div {
      margin-bottom: 1.5rem;
    }
  </style>
</head>
<body>
  <main class="container">
    <h1>고로아와세 변환기</h1>
    <form role="group">
      <textarea id="text" placeholder="변환할 텍스트를 입력하거나 붙여넣으세요..."></textarea>
      <button id="paste-button" class="secondary">붙여넣기</button>
    </form>
    <div id="suggestions" aria-label="변환 제안">
      <button type="button" style="margin: 0.25rem;">선택할 고로아와세가 없습니다</button>
    </div>
    <form role="group">
      <textarea id="result" readonly placeholder="결과"></textarea>
      <button id="copy-button" type="button">복사</button>
    </form>
  </main>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const textInput = document.getElementById('text');
        const resultOutput = document.getElementById('result');
        const suggestionsDiv = document.getElementById('suggestions');
        const pasteButton = document.getElementById('paste-button');
        const copyButton = document.getElementById('copy-button');

        const goroMap = {
            // あ행
            'あ': ['1'], 'ア': ['1'], '아': ['1'],
            'い': ['1', '5', '50'], 'イ': ['1', '5', '50'], '이': ['1', '5', '50'],
            'う': ['5'], 'ウ': ['5'], '우': ['5'],
            'え': ['1', '8', '0'], 'エ': ['1', '8', '0'], '에': ['1', '8', '0'],
            'お': ['0'], 'オ': ['0'], '오': ['0'],
            // か행
            'か': ['5', '9'], 'カ': ['5', '9'], '카': ['5', '9'],
            'き': ['9'], 'キ': ['9'], '키': ['9'],
            'く': ['9'], 'ク': ['9'], '쿠': ['9'],
            'け': ['5'], 'ケ': ['5'], '케': ['5'],
            'こ': ['5', '9'], 'コ': ['5', '9'], '코': ['5', '9'],
            // さ행
            'さ': ['3', '1000'], 'サ': ['3', '1000'], '사': ['3', '1000'],
            'し': ['4'], 'シ': ['4'], '시': ['4'],
            'す': ['3', '4'], 'ス': ['3', '4'], '스': ['3', '4'],
            'せ': ['7'], 'セ': ['7'], '세': ['7'],
            'そ': ['3', '10'], 'ソ': ['3', '10'], '소': ['3', '10'],
            // た행
            'た': ['3'], 'タ': ['3'], '타': ['3'],
            'ち': ['7', '1000'], 'チ': ['7', '1000'], '치': ['7', '1000'],
            'つ': ['2'], 'ツ': ['2'], '츠': ['2'],
            'て': ['7', '10'], 'テ': ['7', '10'], '테': ['7', '10'],
            'と': ['0', '10'], 'ト': ['0', '10'], '토': ['0', '10'],
            // な행
            'な': ['7', '9'], 'ナ': ['7', '9'], '나': ['7', '9'],
            'に': ['2'], 'ニ': ['2'], '니': ['2'],
            'ぬ': ['2'], 'ヌ': ['2'], '누': ['2'],
            'ね': ['2'], 'ネ': ['2'], '네': ['2'],
            'の': ['0', '6'], 'ノ': ['0', '6'], '노': ['0', '6'],
            // は행
            'は': ['5', '8', '20', '100'], 'ハ': ['5', '8', '20', '100'], '하': ['5', '8', '20', '100'],
            'ひ': ['1'], 'ヒ': ['1'], '히': ['1'],
            'ふ': ['2'], 'フ': ['2'], '후': ['2'],
            'へ': ['8'], 'ヘ': ['8'], '헤': ['8'],
            'ほ': ['4', '100'], 'ホ': ['4', '100'], '호': ['4', '100'],
            // ま행
            'ま': ['0'], 'マ': ['0'], '마': ['0'],
            'み': ['3'], 'ミ': ['3'], '미': ['3'],
            'む': ['6'], 'ム': ['6'], '무': ['6'],
            'め': ['6'], 'メ': ['6'], '메': ['6'],
            'も': ['6', '100'], 'モ': ['6', '100'], '모': ['6', '100'],
            // や행
            'や': ['1', '8', '10000'], 'ヤ': ['1', '8', '10000'], '야': ['1', '8', '10000'],
            'ゆ': ['7'], 'ユ': ['7'], '유': ['7'],
            'よ': ['4'], 'ヨ': ['4'], '요': ['4'],
            // ら행
            'ら': ['2', '6'], 'ラ': ['2', '6'], '라': ['2', '6'],
            'り': ['6'], 'リ': ['6'], '리': ['6'],
            'る': ['2', '6'], 'ル': ['2', '6'], '루': ['2', '6'],
            'れ': ['0'], 'レ': ['0'], '레': ['0'],
            'ろ': ['2', '6', '10000'], 'ロ': ['2', '6', '10000'], '로': ['2', '6', '10000'],
            // わ행
            'わ': ['0'], 'ワ': ['0'], '와': ['0'],
            'ゐ': ['1', '5', '50'], 'ヰ': ['1', '5', '50'],
            'ゑ': ['8', '0'], 'ヱ': ['8', '0'],
            'を': ['0'], 'ヲ': ['0'],
            // ん
            'ん': ['6'], 'ン': ['6'],
        };

        let currentIndex = 0;
        let sourceText = '';

        textInput.addEventListener('input', (e) => {
            sourceText = e.target.value;
            currentIndex = 0;
            resultOutput.value = '';
            if (sourceText.length > 0) {
              processNextChar();
            }
        });

        pasteButton.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                textInput.value = text;
                textInput.dispatchEvent(new Event('input', { bubbles: true }));
            } catch (err) {
                console.error('Failed to read clipboard contents: ', err);
                alert('클립보드에서 텍스트를 붙여넣는 데 실패했습니다.');
            }
        });

        copyButton.addEventListener('click', async () => {
            if (!resultOutput.value) return;
            try {
                await navigator.clipboard.writeText(resultOutput.value);
                alert('결과가 클립보드에 복사되었습니다!');
            } catch (err) {
                console.error('Failed to copy text: ', err);
                alert('결과를 복사하는 데 실패했습니다.');
            }
        });

        function processNextChar() {
            suggestionsDiv.innerHTML = '';
            if (currentIndex >= sourceText.length) {
                textInput.setSelectionRange(sourceText.length, sourceText.length);
                suggestionsDiv.innerHTML = '<button type="button" style="margin: 0.25rem;">선택할 고로아와세가 없습니다</button>';
                return;
            }

            const char = sourceText[currentIndex];

            const possibleNumbers = goroMap[char];

            if (possibleNumbers && possibleNumbers.length > 0) {
                const originalCharButton = document.createElement('button');
                originalCharButton.textContent = `"${char}" (원문자)`;
                originalCharButton.classList.add('secondary');
                originalCharButton.addEventListener('click', () => {
                    handleSelection(char);
                });
                suggestionsDiv.appendChild(originalCharButton);

                possibleNumbers.forEach(num => {
                    const button = document.createElement('button');
                    button.textContent = num;
                    button.addEventListener('click', () => {
                        handleSelection(num);
                    });
                    suggestionsDiv.appendChild(button);
                });
            } else {
                resultOutput.value += char;
                currentIndex++;
                requestAnimationFrame(processNextChar);
            }
        }

        function handleSelection(selectedValue) {
            resultOutput.value += selectedValue;
            currentIndex++;
            processNextChar();
        }
    });
  </script>
</body>
</html>